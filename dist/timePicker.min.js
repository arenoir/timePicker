/*! Timepicker - v0.4.0 - 2013-01-29
* http://labs.perifer.se/timedatepicker/
* Copyright (c) 2013 Dennis Burke; Licensed MIT, GPL */
(function(e){"use strict";function n(t,n,r){t.value=e(n).text(),e(t).change(),t.focus(),r.hide()}function r(e,t){var n=e.getHours(),r=t.show24Hours?n:(n+11)%12+1,s=e.getMinutes();return i(r)+t.separator+i(s)+(t.show24Hours?"":n<12?" AM":" PM")}function i(e){return(e<10?"0":"")+e}function s(e,t){return typeof e=="object"?u(e):o(e,t)}function o(e,t){if(e){var n=e.split(t.separator),r=parseFloat(n[0]),i=parseFloat(n[1]);t.show24Hours||(r===12&&e.indexOf("AM")!==-1?r=0:r!==12&&e.indexOf("PM")!==-1&&(r+=12));var s=new Date(0,0,0,r,i,0);return u(s)}return null}function u(e){return e.setFullYear(2001),e.setMonth(0),e.setDate(0),e}var t={init:function(t){var n=e.extend({},e.fn.timePicker.defaults,t);return this.each(function(){e.timePicker(this,n)})},destroy:function(){return this.each(function(){if(this.timePicker){var t=e(this).data("timepickerdiv");e(this).data("timepickerdiv",""),e("#"+t).remove(),delete this.timePicker}})}};e.timePicker=function(t,n){try{var r=e(t)[0];return r.timePicker||(r.timePicker=new e._timePicker(r,n))}catch(i){throw"timepicker must be called on an element"}},e.timePicker.version="0.4.0",e._timePicker=function(t,i){var a=!1,f=!1,l=s(i.startTime,i),c=s(i.endTime,i),h="selected",p="li."+h,d="tp"+(new Date).getTime();e(t).attr("autocomplete","off"),e(t).data("timepickerdiv",d);var v=[],m=new Date(l);while(m<=c)v[v.length]=r(m,i),m=new Date(m.setMinutes(m.getMinutes()+i.step));var g=e('<div id="'+d+'" class="time-picker'+(i.show24Hours?"":" time-picker-12hours")+'"></div>'),y=e("<ul></ul>");for(var b=0;b<v.length;b+=1)y.append("<li>"+v[b]+"</li>");g.append(y),g.appendTo("body").hide(),g.mouseover(function(){a=!0}).mouseout(function(){a=!1}),e("li",y).mouseover(function(){f||(e(p,g).removeClass(h),e(this).addClass(h))}).mousedown(function(){a=!0}).click(function(){n(t,this,g,i),a=!1});var w=function(){if(g.is(":visible"))return!1;e("li",g).removeClass(h);var n=e(t).offset();g.css({top:n.top+t.offsetHeight,left:n.left}),g.show();var s=t.value?o(t.value,i):l,a=l.getHours()*60+l.getMinutes(),f=s.getHours()*60+s.getMinutes()-a,p=Math.round(f/i.step),d=u(new Date(0,0,0,0,p*i.step+a,0));d=l<d&&d<=c?d:l;var v=e("li:contains("+r(d,i)+")",g);return v.length&&(v.addClass(h),g[0].scrollTop=v[0].offsetTop),!0};e(t).focus(w).click(w),e(t).blur(function(){a||g.hide()}),e(t).keydown(function(r){var s;f=!0;var o=g[0].scrollTop;switch(r.which){case 38:if(w())break;s=e(p,y);var u=s.prev().addClass(h)[0];u?(s.removeClass(h),u.offsetTop<o&&(g[0].scrollTop=o-u.offsetHeight)):(s.removeClass(h),u=e("li:last",y).addClass(h)[0],g[0].scrollTop=u.offsetTop-u.offsetHeight);break;case 40:if(w())break;s=e(p,y);var a=s.next().addClass(h)[0];a?(s.removeClass(h),a.offsetTop+a.offsetHeight>o+g[0].offsetHeight&&(g[0].scrollTop=o+a.offsetHeight)):(s.removeClass(h),a=e("li:first",y).addClass(h)[0],g[0].scrollTop=0);break;case 13:if(g.is(":visible")){var l=e(p,y)[0];n(t,l,g,i),r.preventDefault()}break;case 27:g.hide()}}),e(t).keyup(function(){f=!1}),this.getTime=function(){return o(t.value,i)},this.setTime=function(n){t.value=r(s(n,i),i),e(t).change()}},e.fn.timePicker=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist on jQuery.tooltip")},e.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:!0}})(jQuery);